# Internacionalización (i18n) en Angular

## ¿Qué es i18n?

**i18n** es la abreviatura de *internationalization* (18 letras entre la "i" y la "n"). Consiste en preparar la aplicación para soportar múltiples idiomas y configuraciones regionales (fechas, números, monedas, plurales, etc.).

Angular ofrece **dos enfoques**:

| Enfoque | Cuándo usarlo |
|---|---|
| **`@angular/localize`** (oficial) | Apps compiladas estáticamente; genera un build por locale |
| **`@ngx-translate/core`** (librería) | Apps que cargan traducciones en runtime; un solo build |

---

## Opción 1: `@angular/localize` (compilación estática)

### Instalación

```bash
ng add @angular/localize
```

Esto añade `"@angular/localize/init"` en los polyfills de `angular.json`.

### Marcar textos en templates

```html
<!-- Texto simple -->
<h1 i18n="@@titulo.bienvenida">Bienvenido a mi aplicación</h1>

<!-- Con descripción y ID semántico (recomendado) -->
<p i18n="Descripción del párrafo@@descripcion.intro">
  Esta app te ayuda a gestionar tus tareas.
</p>

<!-- Atributo de un elemento -->
<img [src]="logo" i18n-alt="Texto alternativo del logo@@img.logo.alt" alt="Logo de la empresa">

<!-- Pluralización -->
<span i18n="@@mensajes.contador">
  {mensajes, plural,
    =0 {No tienes mensajes}
    =1 {Tienes 1 mensaje}
    other {Tienes {{mensajes}} mensajes}
  }
</span>
```

> El formato del atributo `i18n` es: `"descripción@@ID_único"`. El `@@ID` es opcional pero **muy recomendado** para que las claves sean estables cuando cambia el texto.

### Marcar cadenas en TypeScript con `$localize`

```typescript
import { Component } from '@angular/core';

@Component({ /* ... */ })
export class ProductoComponent {
  titulo = $localize`:@@producto.titulo:Detalles del producto`;

  getError(campo: string): string {
    return $localize`:@@error.campo.requerido:El campo ${campo} es obligatorio`;
  }
}
```

### Extraer los textos a un archivo XLIFF

```bash
ng extract-i18n --output-path src/locale
```

Genera `src/locale/messages.xlf` (formato XLIFF 1.2 por defecto):

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<xliff version="1.2" xmlns="urn:oasis:names:tc:xliff:document:1.2">
  <file source-language="en-US" datatype="plaintext" original="ng2.template">
    <body>
      <trans-unit id="titulo.bienvenida" datatype="html">
        <source>Bienvenido a mi aplicación</source>
        <context-group purpose="location">
          <context context-type="sourcefile">src/app/home/home.component.html</context>
          <context context-type="linenumber">3</context>
        </context-group>
      </trans-unit>
    </body>
  </file>
</xliff>
```

### Crear el archivo de traducción

Copia el archivo para cada idioma y añade `<target>`:

```bash
cp src/locale/messages.xlf src/locale/messages.es.xlf
cp src/locale/messages.xlf src/locale/messages.fr.xlf
```

`messages.es.xlf`:
```xml
<trans-unit id="titulo.bienvenida" datatype="html">
  <source>Welcome to my application</source>
  <target>Bienvenido a mi aplicación</target>
</trans-unit>
```

### Configurar `angular.json`

```json
{
  "projects": {
    "mi-app": {
      "i18n": {
        "sourceLocale": "en-US",
        "locales": {
          "es": {
            "translation": "src/locale/messages.es.xlf",
            "baseHref": "/es/"
          },
          "fr": {
            "translation": "src/locale/messages.fr.xlf",
            "baseHref": "/fr/"
          }
        }
      },
      "architect": {
        "build": {
          "options": {
            "localize": true
          }
        }
      }
    }
  }
}
```

### Compilar para todos los idiomas

```bash
# Build de producción (genera un directorio por locale)
ng build --localize

# Resultado:
# dist/mi-app/
# ├── en-US/
# ├── es/
# └── fr/
```

### Servir un locale en desarrollo

```bash
ng serve --configuration=es
```

### Ventajas y limitaciones de `@angular/localize`

| ✅ Ventajas | ❌ Limitaciones |
|---|---|
| Máximo rendimiento (sin overhead en runtime) | Un build por locale (CI/CD más lento) |
| Optimización de traducciones en tiempo de compilación | No se puede cambiar idioma sin recargar |
| Soporte de ICU (plurales, géneros) | Requiere servidor que sirva el locale correcto |

---

## Opción 2: `@ngx-translate/core` (runtime)

Esta librería es más flexible: **un solo build** con traducciones cargadas dinámicamente en JSON.

### Instalación

```bash
npm install @ngx-translate/core @ngx-translate/http-loader
```

### Configuración en `app.config.ts`

```typescript
import { ApplicationConfig, importProvidersFrom } from '@angular/core';
import { provideHttpClient } from '@angular/common/http';
import { TranslateModule, TranslateLoader } from '@ngx-translate/core';
import { TranslateHttpLoader } from '@ngx-translate/http-loader';
import { HttpClient } from '@angular/common/http';

export function createTranslateLoader(http: HttpClient) {
  return new TranslateHttpLoader(http, './assets/i18n/', '.json');
}

export const appConfig: ApplicationConfig = {
  providers: [
    provideHttpClient(),
    importProvidersFrom(
      TranslateModule.forRoot({
        defaultLanguage: 'es',
        loader: {
          provide: TranslateLoader,
          useFactory: createTranslateLoader,
          deps: [HttpClient]
        }
      })
    )
  ]
};
```

### Archivos de traducción JSON

```
public/assets/i18n/
├── es.json
├── en.json
└── fr.json
```

`es.json`:
```json
{
  "nav": {
    "inicio": "Inicio",
    "acerca": "Acerca de",
    "contacto": "Contacto"
  },
  "bienvenida": "Hola, {{nombre}}!",
  "items": "Tienes {{count}} elemento",
  "items_plural": "Tienes {{count}} elementos"
}
```

`en.json`:
```json
{
  "nav": {
    "inicio": "Home",
    "acerca": "About",
    "contacto": "Contact"
  },
  "bienvenida": "Hello, {{nombre}}!",
  "items": "You have {{count}} item",
  "items_plural": "You have {{count}} items"
}
```

### Uso en templates

```html
<!-- pipe translate -->
<h1>{{ 'nav.inicio' | translate }}</h1>

<!-- con parámetros -->
<p>{{ 'bienvenida' | translate:{ nombre: usuario.nombre } }}</p>

<!-- directiva -->
<span [translate]="'nav.acerca'"></span>

<!-- directiva con parámetros -->
<span translate [translateParams]="{ count: total }">items</span>
```

### Uso en TypeScript

```typescript
import { Component, inject } from '@angular/core';
import { TranslateService } from '@ngx-translate/core';

@Component({
  selector: 'app-root',
  standalone: true,
  imports: [TranslatePipe],
  template: `
    <select (change)="cambiarIdioma($event)">
      <option value="es">Español</option>
      <option value="en">English</option>
      <option value="fr">Français</option>
    </select>
    <h1>{{ 'nav.inicio' | translate }}</h1>
  `
})
export class AppComponent {
  private translate = inject(TranslateService);

  constructor() {
    // Idioma del navegador como fallback
    const idiomaBrowser = navigator.language.split('-')[0];
    this.translate.setDefaultLang('es');
    this.translate.use(idiomaBrowser);
  }

  cambiarIdioma(event: Event) {
    const idioma = (event.target as HTMLSelectElement).value;
    this.translate.use(idioma);
  }

  // En código TS: obtener una traducción como Observable
  obtenerMensaje() {
    this.translate.get('bienvenida', { nombre: 'Ana' }).subscribe(msg => {
      console.log(msg); // "Hola, Ana!"
    });
  }

  // Traducción síncrona (solo si el idioma ya está cargado)
  obtenerMensajeSync() {
    return this.translate.instant('nav.inicio');
  }
}
```

### Ventajas y limitaciones de `@ngx-translate`

| ✅ Ventajas | ❌ Limitaciones |
|---|---|
| Un solo build para todos los idiomas | Overhead en runtime |
| Cambio de idioma sin recargar la página | No es oficial de Angular |
| Fácil integración con API (traducciones remotas) | ICU (plurales) menos robusto que `@angular/localize` |
| Ideal para dashboards con selector de idioma | |

---

## Formateo de fechas, números y monedas

Angular incluye pipes localizados que se adaptan automáticamente al locale configurado:

```typescript
// app.config.ts — registrar el locale
import { LOCALE_ID } from '@angular/core';
import { registerLocaleData } from '@angular/common';
import localeEs from '@angular/common/locales/es';

registerLocaleData(localeEs);

export const appConfig: ApplicationConfig = {
  providers: [
    { provide: LOCALE_ID, useValue: 'es-CO' }  // Colombia
  ]
};
```

```html
<!-- Fechas -->
<p>{{ hoy | date:'fullDate' }}</p>
<!-- "lunes, 10 de febrero de 2025" (con locale es-CO) -->

<!-- Números -->
<p>{{ 1234567.89 | number:'1.2-2' }}</p>
<!-- "1.234.567,89" (punto de miles, coma decimal) -->

<!-- Moneda -->
<p>{{ precio | currency:'COP':'symbol':'1.0-0' }}</p>
<!-- "$ 45.000" -->

<!-- Porcentaje -->
<p>{{ 0.856 | percent:'1.0-1' }}</p>
<!-- "85,6 %" -->
```

---

## Comparativa final

| Característica | `@angular/localize` | `@ngx-translate` |
|---|---|---|
| Rendimiento | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |
| Cambio idioma sin reload | ❌ | ✅ |
| Soporte plurales/ICU | ✅ nativo | Parcial |
| Configuración | Media | Baja |
| Builds en CI/CD | 1 por locale | 1 total |
| Recomendado para | Marketing, e-commerce | Dashboards, SaaS |

---

## Resumen de comandos

```bash
# Instalar soporte oficial
ng add @angular/localize

# Extraer textos marcados con i18n / $localize
ng extract-i18n --output-path src/locale

# Build con todos los locales
ng build --localize

# Instalar ngx-translate
npm install @ngx-translate/core @ngx-translate/http-loader
```
